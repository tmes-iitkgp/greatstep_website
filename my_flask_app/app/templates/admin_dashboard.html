{% extends "admin_base.html" %}

{% block content %}
<!-- Stats Cards -->
<div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-4 tw-gap-6 tw-mb-8">
    <div class="tw-bg-[#1e293b] tw-p-6 tw-rounded-xl tw-border tw-border-slate-700">
        <div class="tw-text-slate-400 tw-text-sm tw-font-medium tw-mb-2">Total Revenue</div>
        <div class="tw-text-3xl tw-font-bold tw-text-emerald-400">₹{{ stats.revenue }}</div>
    </div>

    <div class="tw-bg-[#1e293b] tw-p-6 tw-rounded-xl tw-border tw-border-slate-700">
        <div class="tw-text-slate-400 tw-text-sm tw-font-medium tw-mb-2">Verified Registrations</div>
        <div class="tw-text-3xl tw-font-bold tw-text-white">{{ stats.verified }}</div>
    </div>

    <div class="tw-bg-[#1e293b] tw-p-6 tw-rounded-xl tw-border tw-border-slate-700">
        <div class="tw-text-slate-400 tw-text-sm tw-font-medium tw-mb-2">Pending Verification</div>
        <div class="tw-text-3xl tw-font-bold tw-text-amber-400">{{ stats.pending }}</div>
    </div>

    <div class="tw-bg-[#1e293b] tw-p-6 tw-rounded-xl tw-border tw-border-slate-700">
        <div class="tw-text-slate-400 tw-text-sm tw-font-medium tw-mb-2">Total Signups</div>
        <div class="tw-text-3xl tw-font-bold tw-text-blue-400">{{ stats.total_registrations }}</div>
    </div>
</div>

<!-- Main Section -->
<div class="tw-bg-[#1e293b] tw-rounded-xl tw-border tw-border-slate-700 tw-overflow-hidden">

    <!-- Toolbar -->
    <div class="tw-p-4 tw-border-b tw-border-slate-700 tw-flex tw-justify-between tw-items-center">
        <div class="tw-flex tw-gap-2">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="verification_pending">Pending</button>
            <button class="filter-btn" data-filter="completed">Verified</button>
            <button class="filter-btn" data-filter="failed">Rejected</button>
        </div>
        <div class="tw-relative">
            <input type="text" id="searchInput" placeholder="Search name, txn ID..."
                class="tw-bg-[#0f172a] tw-border tw-border-slate-700 tw-text-sm tw-rounded-lg tw-px-4 tw-py-2 tw-w-64 tw-text-white focus:tw-outline-none focus:tw-border-blue-500">
        </div>
    </div>

    <!-- Table -->
    <div class="tw-overflow-x-auto">
        <table class="tw-w-full tw-text-left">
            <thead class="tw-bg-[#0f172a] tw-text-slate-400 tw-uppercase tw-text-xs tw-font-semibold">
                <tr>
                    <th class="tw-px-6 tw-py-4">User Details</th>
                    <th class="tw-px-6 tw-py-4">College Info</th>
                    <th class="tw-px-6 tw-py-4">Payment Info</th>
                    <th class="tw-px-6 tw-py-4">Amount</th>
                    <th class="tw-px-6 tw-py-4">Status</th>
                    <th class="tw-px-6 tw-py-4">Actions</th>
                </tr>
            </thead>
            <tbody class="tw-divide-y tw-divide-slate-700" id="regTableBody">
                {% for reg in registrations %}
                <tr class="reg-row" data-status="{{ reg.payment_status }}">
                    <td class="tw-px-6 tw-py-4">
                        <div class="tw-font-medium tw-text-white">{{ reg.first_name }} {{ reg.last_name }}</div>
                        <div class="tw-text-sm tw-text-slate-400">{{ reg.email }}</div>
                        <div class="tw-text-xs tw-text-slate-500 tw-mt-1">{{ reg.mobile }}</div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        <div class="tw-text-sm tw-text-white">{{ reg.college }}</div>
                        <div class="tw-text-xs tw-text-slate-400">Year: {{ reg.year }}</div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        {% if reg.transaction_id %}
                        <div
                            class="tw-font-mono tw-text-xs tw-bg-blue-900/30 tw-text-blue-400 tw-px-2 tw-py-1 tw-rounded tw-inline-block">
                            {{ reg.transaction_id }}
                        </div>
                        <div class="tw-text-xs tw-text-slate-500 tw-mt-1">Manual UPI</div>
                        {% else %}
                        <div
                            class="tw-font-mono tw-text-xs tw-bg-purple-900/30 tw-text-purple-400 tw-px-2 tw-py-1 tw-rounded tw-inline-block">
                            {{ reg.razorpay_payment_id }}
                        </div>
                        <div class="tw-text-xs tw-text-slate-500 tw-mt-1">Razorpay</div>
                        {% endif %}
                        <div class="tw-text-xs tw-text-slate-600 tw-mt-1">{{ reg.created_at.strftime('%b %d, %H:%M') }}
                        </div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        <div class="tw-font-semibold tw-text-slate-200">₹{{ reg.amount_paid // 100 }}</div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        {% if reg.payment_status == 'completed' %}
                        <span
                            class="tw-bg-emerald-500/10 tw-text-emerald-400 tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-emerald-500/20">Verified</span>
                        {% elif reg.payment_status == 'verification_pending' %}
                        <span
                            class="tw-bg-amber-500/10 tw-text-amber-400 tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-amber-500/20">Pending</span>
                        {% else %}
                        <span
                            class="tw-bg-red-500/10 tw-text-red-400 tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-red-500/20">Rejected</span>
                        {% endif %}
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        {% if reg.payment_status == 'verification_pending' %}
                        <div class="tw-flex tw-gap-2">
                            <form action="{{ url_for('admin_verify_payment', reg_id=reg.id) }}" method="POST"
                                onsubmit="return confirm('Verify this payment?');">
                                <button type="submit"
                                    class="tw-p-2 tw-bg-emerald-600 hover:tw-bg-emerald-500 tw-text-white tw-rounded-lg tw-transition-colors"
                                    title="Verify">
                                    <i class="fas fa-check"></i>
                                </button>
                            </form>
                            <form action="{{ url_for('admin_reject_payment', reg_id=reg.id) }}" method="POST"
                                onsubmit="return confirm('Reject this payment?');">
                                <button type="submit"
                                    class="tw-p-2 tw-bg-red-900/50 hover:tw-bg-red-800/50 tw-text-red-400 tw-border tw-border-red-800 tw-rounded-lg tw-transition-colors"
                                    title="Reject">
                                    <i class="fas fa-times"></i>
                                </button>
                            </form>
                        </div>
                        {% else %}
                        <span class="tw-text-slate-600 tw-text-sm">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .filter-btn {
        background: transparent;
        color: #94a3b8;
        padding: 6px 16px;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
    }

    .filter-btn:hover {
        color: white;
        background: rgba(255, 255, 255, 0.05);
    }

    .filter-btn.active {
        background: #3b82f6;
        color: white;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
</style>

<script>
    // Tab Filtering
    const filterBtns = document.querySelectorAll('.filter-btn');
    const rows = document.querySelectorAll('.reg-row');

    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Update active state
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const status = btn.dataset.filter;

            rows.forEach(row => {
                if (status === 'all' || row.dataset.status === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    });

    // Search Filtering
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();

        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            if (text.includes(term)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}