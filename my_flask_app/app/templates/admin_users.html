{% extends "admin_base.html" %}

{% block content %}
<div class="tw-bg-[#1e293b] tw-rounded-xl tw-border tw-border-slate-700 tw-overflow-hidden">

    <!-- Toolbar -->
    <div class="tw-p-4 tw-border-b tw-border-slate-700 tw-flex tw-justify-between tw-items-center">
        <h2 class="tw-text-lg tw-font-semibold tw-text-white">User Management</h2>

        <div class="tw-relative">
            <input type="text" id="searchInput" placeholder="Search users..."
                class="tw-bg-[#0f172a] tw-border tw-border-slate-700 tw-text-sm tw-rounded-lg tw-px-4 tw-py-2 tw-w-64 tw-text-white focus:tw-outline-none focus:tw-border-blue-500">
        </div>
    </div>

    <!-- Table (Desktop) -->
    <div class="tw-hidden md:tw-block tw-overflow-x-auto">
        <table class="tw-w-full tw-text-left tw-min-w-[800px]">
            <thead class="tw-bg-[#0f172a] tw-text-slate-400 tw-uppercase tw-text-xs tw-font-semibold">
                <tr>
                    <th class="tw-px-6 tw-py-4">User</th>
                    <th class="tw-px-6 tw-py-4">Contact</th>
                    <th class="tw-px-6 tw-py-4">Role</th>
                    <th class="tw-px-6 tw-py-4">Joined</th>
                    <th class="tw-px-6 tw-py-4">Actions</th>
                </tr>
            </thead>
            <tbody class="tw-divide-y tw-divide-slate-700">
                {% for u in users %}
                <tr class="user-row">
                    <td class="tw-px-6 tw-py-4">
                        <div class="tw-font-medium tw-text-white">{{ u.first_name }} {{ u.last_name }}</div>
                        <div class="tw-text-sm tw-text-slate-400">{{ u.email }}</div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        <div class="tw-text-sm tw-text-slate-300">{{ u.mobile }}</div>
                        <div class="tw-text-xs tw-text-slate-500">{{ u.college }}</div>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        {% if u.is_admin %}
                        <span
                            class="tw-bg-purple-500/10 tw-text-purple-400 tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-purple-500/20">Admin</span>
                        {% else %}
                        <span
                            class="tw-bg-slate-500/10 tw-text-slate-400 tw-px-3 tw-py-1 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-slate-500/20">User</span>
                        {% endif %}
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        <span class="tw-text-sm tw-text-slate-400">{{ u.created_at.strftime('%Y-%m-%d') }}</span>
                    </td>
                    <td class="tw-px-6 tw-py-4">
                        {% if u.is_admin %}
                        {% if u.id == session.get('user_id') %}
                        <span class="tw-text-xs tw-text-slate-500 tw-italic">You</span>
                        {% else %}
                        <form action="{{ url_for('admin_revoke_user', user_id=u.id) }}" method="POST"
                            onsubmit="return confirm('Revoke admin access for {{ u.email }}?');">
                            <button type="submit"
                                class="tw-px-3 tw-py-1 tw-bg-red-900/30 hover:tw-bg-red-900/50 tw-text-red-400 tw-border tw-border-red-800 tw-rounded tw-text-xs tw-font-semibold tw-transition-colors">
                                Revoke Admin
                            </button>
                        </form>
                        {% endif %}
                        {% else %}
                        <form action="{{ url_for('admin_promote_user', user_id=u.id) }}" method="POST"
                            onsubmit="return confirm('Promote {{ u.email }} to Admin?');">
                            <button type="submit"
                                class="tw-px-3 tw-py-1 tw-bg-blue-600 hover:tw-bg-blue-500 tw-text-white tw-rounded tw-text-xs tw-font-semibold tw-transition-colors">
                                Make Admin
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Mobile Card View -->
    <div class="md:tw-hidden tw-divide-y tw-divide-slate-700">
        {% for u in users %}
        <div class="user-row tw-p-4">
            <div class="tw-flex tw-justify-between tw-items-start tw-mb-3">
                <div>
                    <div class="tw-font-medium tw-text-white">{{ u.first_name }} {{ u.last_name }}</div>
                    <div class="tw-text-xs tw-text-slate-400">{{ u.email }}</div>
                </div>
                <div>
                    {% if u.is_admin %}
                    <span
                        class="tw-bg-purple-500/10 tw-text-purple-400 tw-px-2 tw-py-0.5 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-purple-500/20">Admin</span>
                    {% else %}
                    <span
                        class="tw-bg-slate-500/10 tw-text-slate-400 tw-px-2 tw-py-0.5 tw-rounded-full tw-text-xs tw-font-medium tw-border tw-border-slate-500/20">User</span>
                    {% endif %}
                </div>
            </div>

            <div class="tw-grid tw-grid-cols-2 tw-gap-2 tw-text-sm tw-mb-4">
                <div>
                    <div class="tw-text-xs tw-text-slate-500">Contact</div>
                    <div class="tw-text-slate-300">{{ u.mobile }}</div>
                </div>
                <div>
                    <div class="tw-text-xs tw-text-slate-500">College</div>
                    <div class="tw-text-slate-300">{{ u.college }}</div>
                </div>
                <div class="tw-col-span-2">
                    <div class="tw-text-xs tw-text-slate-500">Joined</div>
                    <div class="tw-text-slate-300">{{ u.created_at.strftime('%Y-%m-%d') }}</div>
                </div>
            </div>

            <div class="tw-pt-2 tw-border-t tw-border-slate-700/50">
                {% if u.is_admin %}
                {% if u.id == session.get('user_id') %}
                <div class="tw-text-center tw-text-sm tw-text-slate-500 tw-italic tw-py-2">You</div>
                {% else %}
                <form action="{{ url_for('admin_revoke_user', user_id=u.id) }}" method="POST"
                    onsubmit="return confirm('Revoke admin access for {{ u.email }}?');" class="tw-w-full">
                    <button type="submit"
                        class="tw-w-full tw-py-2 tw-bg-red-900/30 hover:tw-bg-red-900/50 tw-text-red-400 tw-border tw-border-red-800 tw-rounded tw-text-sm tw-font-semibold tw-transition-colors">
                        Revoke Admin
                    </button>
                </form>
                {% endif %}
                {% else %}
                <form action="{{ url_for('admin_promote_user', user_id=u.id) }}" method="POST"
                    onsubmit="return confirm('Promote {{ u.email }} to Admin?');" class="tw-w-full">
                    <button type="submit"
                        class="tw-w-full tw-py-2 tw-bg-blue-600 hover:tw-bg-blue-500 tw-text-white tw-rounded tw-text-sm tw-font-semibold tw-transition-colors">
                        Make Admin
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    // Search Filtering
    const searchInput = document.getElementById('searchInput');
    const rows = document.querySelectorAll('.user-row');

    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();

        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            if (text.includes(term)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}